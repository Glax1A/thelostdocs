<!DOCTYPE html>
<html>
<head>
  <title>Break Reminder</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    label {
      font-weight: bold;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
    }

    #notification {
      display: none;
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #f0f0f0;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }

    #breakTimeBox {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Break Reminder Settings</h1>
  <form id="settingsForm">
    <div>
      <label for="interval">Notification Interval (in minutes):</label>
      <input type="number" id="interval" min="1" value="15" required>
    </div>
    <div>
      <label>Meeting Times:</label>
      <div id="meetingTimesContainer">
        <div class="meetingTime">
          <input type="time" class="start">
          <span>to</span>
          <input type="time" class="end">
          <button type="button" class="remove">Remove</button>
        </div>
      </div>
      <button type="button" id="addMeetingTime">Add Meeting Time</button>
    </div>
    <div id="breakTimeBox">
      <label for="breakStart">Break Start Time:</label>
      <input type="time" id="breakStart">
      <label for="breakEnd">Break End Time:</label>
      <input type="time" id="breakEnd">
      <button type="button" id="addBreakTime">Add Break Time</button>
    </div>
    <div>
      <button type="button" id="start">Start</button>
      <button type="submit" id="save">Save Settings</button>
      <button type="button" id="cancel">Cancel</button>
    </div>
  </form>

  <div id="notification"></div>

  <script>

    // Array of reasons for break notifications
    const reasons = [
      "Taking breaks improves productivity.",
      "Sitting for too long can cause health problems.",
      "Fresh air and sunlight are good for your well-being.",
      "Exercise and movement help maintain a healthy lifestyle.",
      "Breaks can improve focus and creativity."
    ];

    // Function to display notification
    function showNotification() {
      const randomReason = reasons[Math.floor(Math.random() * reasons.length)];

      if (Notification.permission === 'granted') {
        new Notification('Take a break!', {
          body: randomReason,
          icon: 'notification-icon.png'
        });
      }
    }

    // Function to hide notification
    function hideNotification() {
      // No action needed
    }

    // Function to check if the browser supports notifications
    function isNotificationSupported() {
      return 'Notification' in window;
    }

    // Function to request permission for notifications
    function requestNotificationPermission() {
      return new Promise(function (resolve, reject) {
        if (!isNotificationSupported()) {
          reject(new Error('Notifications are not supported in this browser.'));
        }

        if (Notification.permission === 'granted') {
          resolve();
        } else if (Notification.permission !== 'denied' || Notification.permission === 'default') {
          Notification.requestPermission().then(function (permission) {
            if (permission === 'granted') {
              resolve();
            } else {
              reject(new Error('Notification permission denied.'));
            }
          });
        } else {
          reject(new Error('Notification permission denied.'));
        }
      });
    }

    // Function to check if current time is within meeting hours
    function isMeetingTime() {
      const now = new Date();
      const currentHour = now.getHours();
      const currentMinute = now.getMinutes();

      for (let i = 0; i < meetingTimes.length; i++) {
        const meetingStart = new Date();
        meetingStart.setHours(
          parseInt(meetingTimes[i].start.split(':')[0]),
          parseInt(meetingTimes[i].start.split(':')[1])
        );

        const meetingEnd = new Date();
        meetingEnd.setHours(
          parseInt(meetingTimes[i].end.split(':')[0]),
          parseInt(meetingTimes[i].end.split(':')[1])
        );

        if (now >= meetingStart && now <= meetingEnd) {
          return true;
        }
      }

      return false;
    }

    // Function to check if current time is within break hours
    function isBreakTime() {
      const now = new Date();
      const currentHour = now.getHours();
      const currentMinute = now.getMinutes();

      for (let i = 0; i < breakTimes.length; i++) {
        const breakStart = new Date();
        breakStart.setHours(
          parseInt(breakTimes[i].start.split(':')[0]),
          parseInt(breakTimes[i].start.split(':')[1])
        );

        const breakEnd = new Date();
        breakEnd.setHours(
          parseInt(breakTimes[i].end.split(':')[0]),
          parseInt(breakTimes[i].end.split(':')[1])
        );

        if (now >= breakStart && now <= breakEnd) {
          return true;
        }
      }

      return false;
    }

    // Function to add a new meeting time input field
    function addMeetingTime() {
      const meetingTimesContainer = document.getElementById('meetingTimesContainer');
      const newMeetingTime = document.createElement('div');
      newMeetingTime.classList.add('meetingTime');
      newMeetingTime.innerHTML = `
        <input type="time" class="start">
        <span>to</span>
        <input type="time" class="end">
        <button type="button" class="remove">Remove</button>
      `;
      meetingTimesContainer.appendChild(newMeetingTime);

      const removeButton = newMeetingTime.querySelector('.remove');
      removeButton.addEventListener('click', function () {
        newMeetingTime.remove();
      });
    }

    // Function to add a new break time input field
    function addBreakTime() {
      const breakStartInput = document.getElementById('breakStart');
      const breakEndInput = document.getElementById('breakEnd');
      const breakStartValue = breakStartInput.value;
      const breakEndValue = breakEndInput.value;
      const breakTime = { start: breakStartValue, end: breakEndValue };
      breakTimes.push(breakTime);

      const breakTimesContainer = document.getElementById('breakTimesContainer');
      const newBreakTime = document.createElement('div');
      newBreakTime.classList.add('breakTime');
      newBreakTime.innerHTML = `
        <span>${breakStartValue} to ${breakEndValue}</span>
        <button type="button" class="remove">Remove</button>
      `;
      breakTimesContainer.appendChild(newBreakTime);

      breakStartInput.value = '';
      breakEndInput.value = '';

      const removeButton = newBreakTime.querySelector('.remove');
      removeButton.addEventListener('click', function () {
        const index = breakTimes.indexOf(breakTime);
        if (index !== -1) {
          breakTimes.splice(index, 1);
        }
        newBreakTime.remove();
      });
    }

    // Function to handle form submission and save settings
    function saveSettings(event) {
      event.preventDefault();

      // Get notification interval
      const intervalInput = document.getElementById('interval');
      const interval = parseInt(intervalInput.value);

      // Get meeting times
      const meetingTimeInputs = document.querySelectorAll('.meetingTime');
      const meetingTimes = [];
      meetingTimeInputs.forEach(function (meetingTimeInput) {
        const startInput = meetingTimeInput.querySelector('.start');
        const endInput = meetingTimeInput.querySelector('.end');
        const startValue = startInput.value;
        const endValue = endInput.value;
        meetingTimes.push({ start: startValue, end: endValue });
      });

      // Update break interval and meeting times
      breakInterval = interval;
      breakTimes = meetingTimes;

      // Get break times
      const breakTimeInputs = document.querySelectorAll('.breakTime');
      const breakTimes = [];
      breakTimeInputs.forEach(function (breakTimeInput) {
        const startEndValues = breakTimeInput.querySelector('span').textContent.split(' to ');
        const startValue = startEndValues[0];
        const endValue = startEndValues[1];
        breakTimes.push({ start: startValue, end: endValue });
      });

      // Update break times
      breakTimes = breakTimes;

      // Hide notification if currently displayed
      hideNotification();

      // Restart the break reminder
      clearInterval(breakReminder);
      breakReminder = setInterval(function () {
        if (!isMeetingTime() && !isBreakTime()) {
          showNotification();
        }
      }, breakInterval * 60 * 1000); // Convert minutes to milliseconds

      // Save settings to localStorage
      localStorage.setItem('breakInterval', breakInterval);
      localStorage.setItem('meetingTimes', JSON.stringify(meetingTimes));
      localStorage.setItem('breakTimes', JSON.stringify(breakTimes));

      // Display success message
      alert('Settings saved!');
    }

    // Function to cancel and reset form values
    function cancelSettings() {
      const intervalInput = document.getElementById('interval');
      intervalInput.value = breakInterval;

      const meetingTimesContainer = document.getElementById('meetingTimesContainer');
      meetingTimesContainer.innerHTML = '';
      meetingTimes.forEach(function (meetingTime) {
        const newMeetingTime = document.createElement('div');
        newMeetingTime.classList.add('meetingTime');
        newMeetingTime.innerHTML = `
          <input type="time" class="start" value="${meetingTime.start}">
          <span>to</span>
          <input type="time" class="end" value="${meetingTime.end}">
          <button type="button" class="remove">Remove</button>
        `;
        meetingTimesContainer.appendChild(newMeetingTime);

        const removeButton = newMeetingTime.querySelector('.remove');
        removeButton.addEventListener('click', function () {
          newMeetingTime.remove();
        });
      });

      const breakTimesContainer = document.getElementById('breakTimesContainer');
      breakTimesContainer.innerHTML = '';
      breakTimes.forEach(function (breakTime) {
        const newBreakTime = document.createElement('div');
        newBreakTime.classList.add('breakTime');
        newBreakTime.innerHTML = `
          <span>${breakTime.start} to ${breakTime.end}</span>
          <button type="button" class="remove">Remove</button>
        `;
        breakTimesContainer.appendChild(newBreakTime);

        const removeButton = newBreakTime.querySelector('.remove');
        removeButton.addEventListener('click', function () {
          const index = breakTimes.indexOf(breakTime);
          if (index !== -1) {
            breakTimes.splice(index, 1);
          }
          newBreakTime.remove();
        });
      });
    }

    // Start the break reminder
    let breakInterval = localStorage.getItem('breakInterval') || 15;
    let meetingTimes = JSON.parse(localStorage.getItem('meetingTimes')) || [];
    let breakTimes = JSON.parse(localStorage.getItem('breakTimes')) || [];
    let breakReminder;

    requestNotificationPermission().then(function () {
      breakReminder = setInterval(function () {
        if (!isMeetingTime() && !isBreakTime()) {
          showNotification();
        }
      }, breakInterval * 60 * 1000); // Convert minutes to milliseconds
    }).catch(function (error) {
      console.log('Error:', error);
    });

    // Add event listeners
    document.getElementById('addMeetingTime').addEventListener('click', addMeetingTime);
    document.getElementById('addBreakTime').addEventListener('click', addBreakTime);
    document.getElementById('start').addEventListener('click', showNotification);
    document.getElementById('settingsForm').addEventListener('submit', saveSettings);
    document.getElementById('cancel').addEventListener('click', cancelSettings);

  </script>
</body>
</html>
